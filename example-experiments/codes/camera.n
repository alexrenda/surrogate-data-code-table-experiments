fun(y, contrast, gamma) {
  // https://graphics.stanford.edu/papers/fcam/html/_demosaic_8cpp_source.html
  gamma = gamma * 2.2;

  y = y {>=0} ^ {>=0} recip{>=1.5}(gamma);

  b = 2 - exp(log{>=2}(2) * contrast);
  a = 2 - 2*b;

  if (y > 0.5) {
    y = 1-y;
    y = a*y*y + b*y;
    y = 1-y;
  } else {
    y = a*y*y + b*y;
  }

  return y;
}